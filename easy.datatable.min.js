// jQuery EasyDataTable Plugin
//
// Version 1.4.0
//
// Copy By RAY
// inthinkcolor@gmail.com
// 2013
//
// https://github.com/ushelp/EasyDataTable
//
var DataTable={cacheData:{},cacheDataRow:{},cacheThLength:{},cachePageTheme:{},cacheLanguage:{},cacheOrderArrow:{},SIMPLE_PAGE:"SIMPLE",FULL_PAGE:"FULL",lOADING_SHOW:false,lOADING_DEFALUT:{},LOADING_MSG:"数据正在读取中……",MSG:{first:"首页",previous:"上一页",next:"下一页",last:"末页",totalCount:"共{0}条",totalPage:"共{0}页",rowPerPage:"每页显示{0}条"},load:function(tableid,easydataParams){var nowDataTable=$("#"+tableid);nowDataTable.find("tr:gt(0)").css("visibility","hidden");easydataParams=easydataParams==undefined?{}:easydataParams;var dataForm=$("form").has("#"+tableid);if(!DataTable.cacheDataRow[tableid]){var dataRow=("<tr>"+nowDataTable.find(" tr:eq(1)").html()+"</tr>").replace(/\n/g,"").replace(/\r/g,"").replace("}%","}%\r\n");DataTable.cacheDataRow[tableid]=dataRow;nowDataTable.find(" tr:eq(1)").find("td").css("border","0");nowDataTable.find(" tr:eq(1)").css("border","0")}if(DataTable.lOADING_DEFALUT[tableid]==undefined){if(!(easydataParams.loading==undefined)){DataTable.lOADING_DEFALUT[tableid]=easydataParams.loading}else{DataTable.lOADING_DEFALUT[tableid]=DataTable.lOADING_SHOW}}if(easydataParams.language){DataTable.cacheLanguage[tableid]=easydataParams.language}if(DataTable.cacheLanguage[tableid]==undefined){DataTable.cacheLanguage[tableid]=DataTable.MSG}if(DataTable.lOADING_DEFALUT[tableid]==true){nowDataTable.find(" tr:gt(0)").remove();nowDataTable.after('<tr name="DataTable_Loading" ><td colspan=\''+$("#"+tableid+" tr:eq(0)").find("th").length+"'><div class='DataTable_Loading'>"+DataTable.LOADING_MSG+"</div></td></tr>")}if(!DataTable.cachePageTheme[tableid]){var usetheme=dataForm.find(".panelBar").attr("pagetheme");if(usetheme&&usetheme.toLowerCase()!="no"){DataTable.cachePageTheme[tableid]=usetheme}else{DataTable.cachePageTheme[tableid]=easydataParams.pagetheme}}var pagenoEle=dataForm.find("[name='pageNo']");var rowperpageEle=dataForm.find("[name='rowPerPage']");if(!this.Validate.integer.test(pagenoEle.val())){pagenoEle.val(1)}if(!this.Validate.integer.test(rowperpageEle.val())){rowperpageEle.val(5)}postParam=dataForm.serialize();$.post(dataForm.attr("action"),postParam,function(data){if(typeof(data)=="string"){data=eval("("+data+")")}DataTable.cacheData[tableid]=data;var content="";var j=0;var valueObject=nowDataTable.attr("value");var dataTableOrder="";var dataTableSort="";if(valueObject){dataTableOrder=data[valueObject].order;dataTableSort=data[valueObject].sort;if(!dataTableOrder){dataTableOrder=data.order}if(!dataTableSort){dataTableSort=data.sort}if(!dataTableOrder){dataTableOrder=""}if(!dataTableSort){dataTableSort=""}DataTable.cacheData[tableid].pageNo=parseInt(data[valueObject].pageNo);DataTable.cacheData[tableid].rowPerPage=parseInt(data[valueObject].rowPerPage);DataTable.cacheData[tableid].totalCount=parseInt(data[valueObject].totalCount);DataTable.cacheData[tableid].order=dataTableOrder;DataTable.cacheData[tableid].sort=dataTableSort;DataTable.cacheData[tableid].maxPage=Math.floor(((DataTable.cacheData[tableid].totalCount-1)/DataTable.cacheData[tableid].rowPerPage)+1);for(var i in data[valueObject].data){data[valueObject].data[i].datatableCount=parseInt(j)+1;data[valueObject].data[i].datatableIndex=parseInt(j);for(var property in data){if(property!=valueObject){data[valueObject].data[i][property]=data[property]}}data[valueObject].data[i].pageNo=parseInt(data[valueObject].pageNo);data[valueObject].data[i].rowPerPage=parseInt(data[valueObject].rowPerPage);data[valueObject].data[i].totalCount=parseInt(data[valueObject].totalCount);data[valueObject].data[i].maxPage=Math.floor(((parseInt(data[valueObject].data[i].totalCount)-1)/parseInt(data[valueObject].data[i].rowPerPage))+1);data[valueObject].data[i].key=i;data[valueObject].data[i].order=dataTableOrder;data[valueObject].data[i].sort=dataTableSort;content+=DataTable.formatContent(DataTable.cacheDataRow[tableid],data[valueObject].data[i]);j++}}else{dataTableOrder=data.order;dataTableSort=data.sort;if(!dataTableOrder){dataTableOrder=""}if(!dataTableSort){dataTableSort=""}DataTable.cacheData[tableid].maxPage=Math.floor(((parseInt(data.totalCount)-1)/parseInt(data.rowPerPage))+1);for(var i in data.data){for(var property in data){if(property!="data"){data.data[i][property]=data[property]}}data.data[i].datatableCount=parseInt(j)+1;data.data[i].datatableIndex=parseInt(j);data.data[i].key=i;data.data[i].maxPage=Math.floor(((parseInt(data.data[i].totalCount)-1)/parseInt(data.data[i].rowPerPage))+1);data.data[i].order=dataTableOrder;data.data[i].sort=dataTableSort;content+=DataTable.formatContent(DataTable.cacheDataRow[tableid],data.data[i]);j++}}nowDataTable.find(" tr:gt(0)").remove();if(DataTable.lOADING_DEFALUT[tableid]==true){dataForm.find("[name='DataTable_Loading']").remove()}var orderInfo='<tr name="sort_order_hidden" style="display:none"><td colspan=\''+$("#"+tableid+" tr:eq(0)").find("th").length+"'><input type='hidden' name='order' value='"+dataTableOrder+"'/><input type='hidden' name='sort' value='"+dataTableSort+"'/></td></tr>";content+=orderInfo;nowDataTable.append(content);nowDataTable.find(" tr:eq(1)").css("visibility","visible");nowDataTable.find(" tr:even").addClass("evenColor");nowDataTable.find(" tr").hover(function(){$(this).addClass("tdHover")},function(){$(this).removeClass("tdHover")});var oldTr;nowDataTable.find(" tr").on("click",function(){if(oldTr){oldTr.removeClass("tdClick")}$(this).addClass("tdClick");oldTr=$(this)});DataTable.pageTheme(tableid,DataTable.cachePageTheme[tableid]);dataForm.find(" .pages .totalCount").html(data.totalCount);dataForm.find(" .mycombox").val(data.rowPerPage);dataForm.find(" [name='pageNo']").val(data.pageNo);dataForm.find(" .pages .maxPage").html(Math.floor(((parseInt(data.totalCount)-1)/parseInt(data.rowPerPage))+1));dataForm.find("[name='rowPerPage']").off("change");dataForm.find("[name='rowPerPage']").on("change",function(e){var row=$(this).val();var pagenoEle=dataForm.find("[name='pageNo']");var maxPage=Math.floor(((DataTable.cacheData[tableid]["totalCount"]-1)/row)+1);if(pagenoEle.val()>maxPage){pagenoEle.val(maxPage)}DataTable.load(tableid)});DataTable.pageCheck(tableid)})},reload:function(b){var a=$("form").has("#"+b);a.find("[name='order']").val("");a.find("[name='sort']").val("");if(DataTable.cacheOrderArrow[b]){DataTable.cacheOrderArrow[b].html("&uarr;&darr;")}DataTable.load(b)},out:function(a){return a},formatContent:function(content,jsondata){var reg=/\{([^}]+)\}/g;var regExp=/\%\{(.*)\}\%/g;content=content.replace(regExp,function(m,i){with(jsondata){try{return eval($.trim(i))}catch(e){return m}}});content=content.replace(reg,function(m,i){with(jsondata){try{return eval($.trim(i))==null?"":eval($.trim(i))}catch(e){return""}}});return content},Validate:{integer:/^[1-9][0-9]*$/},first:function(c){var b=$("form").has("#"+c);var a=b.find("[name='pageNo']");a.val(1);this.load(c)},prev:function(c){var b=$("form").has("#"+c);var a=b.find("[name='pageNo']");a.val(parseInt(this.cacheData[c]["pageNo"])-1);this.load(c)},next:function(c){var b=$("form").has("#"+c);var a=b.find("[name='pageNo']");a.val(parseInt(this.cacheData[c]["pageNo"])+1);this.load(c)},last:function(c){var b=$("form").has("#"+c);var a=b.find("[name='pageNo']");a.val(this.cacheData[c]["maxPage"]);this.load(c)},gopage:function(d){var c=$("form").has("#"+d);var b=c.find("[name='pageNo']");var e=c.find("[name='rowPerPage']").val();var a=Math.floor(((this.cacheData[d]["totalCount"]-1)/e)+1);if(b.val()>a){b.val(a)}if(this.cacheData[d]["pageNo"]!=b.val()&&DataTable.Validate.integer.test(b.val())){this.load(d)}},numgoto:function(c,d){var b=$("form").has("#"+c);var a=b.find("[name='pageNo']");a.val($(d.target).text());if(this.cacheData[c]["pageNo"]!=b.find("[name='pageNo']").val()){this.load(c)}},go:function(e,a,f){var d=$("form").has("#"+e);if(d&&DataTable.Validate.integer.test(a)){if(a<=0){a=1}if(!f||(!DataTable.Validate.integer.test(f))){f=this.cacheData[e]["rowPerPage"]}var c=Math.floor(((this.cacheData[e]["totalCount"]-1)/f)+1);if(a>c){a=c}var b=d.find("[name='pageNo']");if(b.val()){b.val(a)}else{d.append('<input type="hidden" value="'+a+'" name="pageNo"/>')}var g=d.find("[name='rowPerPage']");if(g.val()){g.val(f)}else{d.append('<input type="hidden" value="'+f+'" name="rowPerPage"/>')}d.find("[name='rowPerPage']").val(f);if(this.cacheData[e]["pageNo"]!=a){this.load(e)}}},pageCheck:function(a){var b=$("form").has("#"+a);var i=this.cacheData[a]["maxPage"];var c=parseInt(this.cacheData[a]["pageNo"]);var g=b.find("[name='first']");var e=b.find("[name='prev']");var h=b.find("[name='next']");var j=b.find("[name='last']");var f=b.find("[name='pagegoto']");var d=b.find("[name='numgoto']");g.off("click");e.off("click");h.off("click");j.off("click");f.off("click");d.off("click");g.on("click",function(){DataTable.first(a)});e.on("click",function(){DataTable.prev(a)});h.on("click",function(){DataTable.next(a)});j.on("click",function(){DataTable.last(a)});f.on("click",function(){DataTable.gopage(a)});d.on("click",function(k){DataTable.numgoto(a,k)});g.unbind("mouseenter").unbind("mouseleave");e.unbind("mouseenter").unbind("mouseleave");h.unbind("mouseenter").unbind("mouseleave");j.unbind("mouseenter").unbind("mouseleave");DataTable.loadInit();g.removeClass("firstlastgo");e.removeClass("firstlastgo");h.removeClass("firstlastgo");j.removeClass("firstlastgo");if(c<=1){g.off("click");e.off("click");g.removeClass("pageGoHover");e.removeClass("pageGoHover");g.addClass("firstlastgo");e.addClass("firstlastgo");g.unbind("mouseenter").unbind("mouseleave");e.unbind("mouseenter").unbind("mouseleave")}if(c>=i){j.off("click");h.off("click");j.removeClass("pageGoHover");h.removeClass("pageGoHover");j.addClass("firstlastgo");h.addClass("firstlastgo");j.unbind("mouseenter").unbind("mouseleave");h.unbind("mouseenter").unbind("mouseleave")}},checkAll:function(c,a){var b=c.checked;if(b){$(c.form).find("[name='"+a+"']").each(function(){this.checked=true})}else{$(c.form).find("[name='"+a+"']").each(function(){this.checked=false})}},pageMsgCkeck:function(a){if(!DataTable.cacheLanguage[a].first){DataTable.cacheLanguage[a].first=DataTable.MSG.first}if(!DataTable.cacheLanguage[a].previous){DataTable.cacheLanguage[a].previous=DataTable.MSG.previous}if(!DataTable.cacheLanguage[a].next){DataTable.cacheLanguage[a].next=DataTable.MSG.next}if(!DataTable.cacheLanguage[a].last){DataTable.cacheLanguage[a].last=DataTable.MSG.last}if(!DataTable.cacheLanguage[a].totalPage){DataTable.cacheLanguage[a].totalPage=DataTable.MSG.totalPage}if(!DataTable.cacheLanguage[a].rowPerPage){DataTable.cacheLanguage[a].rowPerPage=DataTable.MSG.rowPerPage}if(!DataTable.cacheLanguage[a].totalCount){DataTable.cacheLanguage[a].totalCount=DataTable.MSG.totalCount}},pageTheme:function(g,z){var n=$("form").has("#"+g);var r="";var t=n.find(".panelBar").attr("pagetheme");if(t&&t.toLowerCase()=="no"){if(!DataTable.cachePageTheme[g]){DataTable.cachePageTheme[g]=n.find(".panelBar").html()}r=DataTable.cachePageTheme[g]}else{var E=n.find(".panelBar").length;if(E!=0){var a=n.find(".panelBar").attr("size");var f=[DataTable.cacheData[g].rowPerPage];if(a){f=a.split(",")}DataTable.pageMsgCkeck(g);var o=DataTable.cacheLanguage[g].rowPerPage.indexOf("{0}");var m=DataTable.cacheLanguage[g].rowPerPage.substring(0,o);var D=DataTable.cacheLanguage[g].rowPerPage.substring(o+3);var l='<div class="pages"><span>'+m+'</span><select class="mycombox" name="rowPerPage" >';$.each(f,function(G,F){l+='<option value="'+F+'" >'+F+"</option>"});l+="</select><span>"+D+"，";var A=DataTable.cacheLanguage[g].totalPage.indexOf("{0}");var w=DataTable.cacheLanguage[g].totalPage.substring(0,A);var k=DataTable.cacheLanguage[g].totalPage.substring(A+3);var C=DataTable.cacheLanguage[g].totalCount.indexOf("{0}");var y=DataTable.cacheLanguage[g].totalCount.substring(0,C);var u=DataTable.cacheLanguage[g].totalCount.substring(C+3);l+=y+'<label class="totalCount"></label>'+u+"</span></div>";var e='<div class="pages " style="float: right;text-align: right;">';var b='<span class="totalPage">'+w+'<label class="maxPage"></label>'+k+"</span>";var p='<span class="pagego" name="first">'+DataTable.cacheLanguage[g].first+'</span><span class="pagego" name="prev">'+DataTable.cacheLanguage[g].previous+"</span>";var B=parseInt(this.cacheData[g]["pageNo"]);var v=Math.floor(((parseInt(this.cacheData[g]["totalCount"])-1)/parseInt(this.cacheData[g]["rowPerPage"]))+1);var j=B-3;var q=B+3;if(j<1){j=1;q=j+6;if(q>v){q=v}}if(q>v){q=v;j=q-6;if(j<1){j=1}}var x="";for(var s=j;s<=q;s++){if(s==B){x+='<span class="pagego nowpagenum" name="numgoto">'+s+"</span>"}else{x+='<span class="pagego" name="numgoto">'+s+"</span>"}}var h='<span class="pagego" name="next">'+DataTable.cacheLanguage[g].next+'</span><span class="pagego" name="last">'+DataTable.cacheLanguage[g].last+"</span>";var c='<span class="pagego"><input type="text" class="gototxt" name="pageNo"  /></span>';c+='<span class="pagegoto" name="pagegoto">&gt;&gt;</span>';var d="</div>";if((!z)||z.toUpperCase()=="FULL"){r=l+e+b+p+x+h+c+d}else{if(z.toUpperCase()=="SIMPLE"){r=l+e+b+p+h+c+d}else{r=l+e+b+p+x+h+c+d}}}}n.find(".panelBar").html(DataTable.formatContent(r,this.cacheData[g]))},loadInit:function(){$(".pagego").hover(function(){$(this).addClass("pageGoHover")},function(){$(this).removeClass("pageGoHover")})},init:function(){$(".pagego").hover(function(){$(this).addClass("pageGoHover")},function(){$(this).removeClass("pageGoHover")});$(".datatable").find("tr:eq(1)").css("visibility","hidden");$("[class~='easydatatable']").each(function(){var a=$(this).attr("id");if(a){DataTable.load(a)}});$("[class~='easydatatable_search']").each(function(){var a=$(this.form).find("table[id]").attr("id");var b=$(this);b.off("click");b.on("click",function(){if(a){DataTable.load(a)}})});$("table:has([order])").each(function(){var b=$(this);var a=b.attr("id");b.find("[order]").each(function(){var d=$(this);d.html(d.html()+"<span class='sortArrow' name='orderspan'>&uarr;&darr;</span>");d.css("cursor","pointer");d.off("click");var c=$("form").has("#"+a);d.on("click",function(h){var f=d.attr("order");c.find("input[name='order']").val(f);c.find("input[name='sort']").val(c.find("input[name='sort']").val().toLowerCase()=="asc"?"desc":"asc");var g=$(this).find("[name='orderspan']");if(DataTable.cacheOrderArrow[a]){DataTable.cacheOrderArrow[a].html("&uarr;&darr;")}if(c.find("input[name='sort']").val()=="asc"){g.html("&uarr;")}else{if(c.find("input[name='sort']").val()=="desc"){g.html("&darr;")}else{g.html("&uarr;&darr;")}}DataTable.cacheOrderArrow[a]=g;DataTable.load(a)})});b.find("[order]").hover(function(){var c=$(this).find("[name='orderspan']");c.removeClass("sortArrow");c.removeClass("sortArrowDown");c.addClass("sortArrowHover")},function(){var c=$(this).find("[name='orderspan']");c.removeClass("sortArrowHover");c.addClass("sortArrow")});b.find("[order]").on("mousedown",function(){var c=$(this).find("[name='orderspan']");c.removeClass("sortArrowHover");c.addClass("sortArrowDown")});b.find("[order]").on("mouseup",function(){var c=$(this).find("[name='orderspan']");c.removeClass("sortArrowDown");c.addClass("sortArrowHover")})})}};$(function(){DataTable.init()});
