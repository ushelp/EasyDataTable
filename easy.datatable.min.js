// jQuery EasyDataTable Plugin
//
// Version 1.6.0
//
// Copy By RAY
// inthinkcolor@gmail.com
// 2013
//
// https://github.com/ushelp/EasyDataTable
//
var DataTable={cacheData:{},cacheDataRow:{},cacheThLength:{},cachePageTheme:{},cacheLanguage:{},cacheOrderArrow:{},cacheInitLoading:{},cacheStartFun:{},cacheEndFun:{},cacheUserPage:{},cacheInit:{},cacheDefaultRow:{},DEFAULT_ROW:5,SIMPLE_PAGE:"SIMPLE",FULL_PAGE:"FULL",lOADING_SHOW:"default",lOADING_DEFALUT:{},LOADING_MSG:"数据正在读取中……",MSG:{first:"首页",previous:"上一页",next:"下一页",last:"末页",totalCount:"共{0}条",totalPage:"共{0}页",rowPerPage:"每页显示{0}条"},load:function(tableid,easydataParams){var dataForm,pagenoEle,rowperpageEle,defRow,initPage,usetheme,dataRow,table_loading_attr,loading_type,nowDataTable=$("[id='"+tableid+"']");if(0!=nowDataTable.length){if(easydataParams=void 0==easydataParams?{}:easydataParams,dataForm=$("form").has("[id='"+tableid+"']"),pagenoEle=dataForm.find("[name='pageNo']"),rowperpageEle=dataForm.find("[name='rowPerPage']"),this.Validate.integer.test(pagenoEle.val())||pagenoEle.val(1),this.Validate.integer.test(rowperpageEle.val())||rowperpageEle.val(this.DEFAULT_ROW),DataTable.cacheInit[tableid]?dataForm.find(".panelBar [id='datatable_pagenum']").html(this.pageNumSpan(tableid,pagenoEle.val())):(DataTable.cacheInit[tableid]=!1,easydataParams.start&&(DataTable.cacheStartFun[tableid]=easydataParams.start),easydataParams.end&&(DataTable.cacheEndFun[tableid]=easydataParams.end),defRow=DataTable.DEFAULT_ROW,this.Validate.integer.test(easydataParams.row)?defRow=easydataParams.row:(defRow=dataForm.find(".panelBar").attr("row"),this.Validate.integer.test(defRow)||(defRow=DataTable.DEFAULT_ROW)),this.cacheDefaultRow[tableid]=defRow+"",initPage="<div id='datatable_initPageData' style='display:none'><input type='hidden' name='pageNo' value='1'/><input type='hidden' name='rowPerPage' value='"+defRow+"' />"+"</div>",dataForm.append(initPage)),DataTable.cacheStartFun[tableid])try{DataTable.cacheStartFun[tableid](nowDataTable[0],!DataTable.cacheInit[tableid])}catch(e){}void 0!=easydataParams.pagetheme&&(DataTable.cachePageTheme[tableid]=easydataParams.pagetheme),DataTable.cachePageTheme[tableid]||(usetheme=dataForm.find(".panelBar").attr("pagetheme"),DataTable.cachePageTheme[tableid]=usetheme?usetheme:DataTable.FULL_PAGE,DataTable.cacheInit[tableid]||(DataTable.cacheUserPage[tableid]=dataForm.find(".panelBar").html(),dataForm.find(".panelBar").html(""))),DataTable.cacheDataRow[tableid]||(dataRow=("<tr>"+nowDataTable.find(" tr:eq(1)").html()+"</tr>").replace(/\n/g,"").replace(/\r/g,"").replace("}%","}%\r\n"),DataTable.cacheDataRow[tableid]=dataRow,nowDataTable.find(" tr:eq(1)").find("td").css("border","0"),nowDataTable.find(" tr:eq(1)").css("border","0")),void 0==DataTable.lOADING_DEFALUT[tableid]&&(table_loading_attr=nowDataTable.attr("loading"),DataTable.lOADING_DEFALUT[tableid]=table_loading_attr?table_loading_attr:DataTable.lOADING_SHOW,void 0!=easydataParams.loading&&(DataTable.lOADING_DEFALUT[tableid]=easydataParams.loading+"")),easydataParams.language&&(DataTable.cacheLanguage[tableid]=easydataParams.language),void 0==DataTable.cacheLanguage[tableid]&&(DataTable.cacheLanguage[tableid]=DataTable.MSG),postParam=dataForm.serialize(),loading_type=DataTable.lOADING_DEFALUT[tableid].toLowerCase(),"default"==loading_type?(void 0==DataTable.cacheInitLoading[tableid]&&(nowDataTable.find(" tr:gt(0)").remove(),DataTable.cacheInitLoading[tableid]="loaded"),nowDataTable.find(" tr:gt(0)").find("*").on("click",function(){return!1}),nowDataTable.find(" tr:gt(0)").find("*").css("color","gray")):"none"==loading_type?(void 0==DataTable.cacheInitLoading[tableid]&&(nowDataTable.find(" tr:gt(0)").remove(),DataTable.cacheInitLoading[tableid]="loaded"),nowDataTable.find("tr:gt(0)").hide()):"hide"==loading_type?(void 0==DataTable.cacheInitLoading[tableid]&&(nowDataTable.find(" tr:gt(0)").remove(),DataTable.cacheInitLoading[tableid]="loaded"),nowDataTable.find("tr:gt(0)").css("visibility","hidden")):"show"==loading_type?(nowDataTable.find(" tr:gt(0)").remove(),$("[id='"+tableid+"_loading_div']").hide(),nowDataTable.after("<div id='"+tableid+"_loading_div' class='DataTable_Loading'>"+DataTable.LOADING_MSG+"</div>")):(nowDataTable.find(" tr:gt(0)").remove(),$("[id='"+tableid+"_loading_div']").hide(),nowDataTable.after("<div id='"+tableid+"_loading_div' class='DataTable_Loading'>"+DataTable.lOADING_DEFALUT[tableid]+"</div>")),$.post(dataForm.attr("action"),postParam,function(data){var content,j,valueObject,dataTableOrder,dataTableSort,i,property,orderInfo,oldTr;if("string"==typeof data&&(data=eval("("+data+")")),DataTable.cacheData[tableid]=data,content="",j=0,valueObject=nowDataTable.attr("value"),dataTableOrder="",dataTableSort="",valueObject){dataTableOrder=data[valueObject].order,dataTableSort=data[valueObject].sort,dataTableOrder||(dataTableOrder=data.order),dataTableSort||(dataTableSort=data.sort),dataTableOrder||(dataTableOrder=""),dataTableSort||(dataTableSort=""),DataTable.cacheData[tableid].pageNo=parseInt(data[valueObject].pageNo),DataTable.cacheData[tableid].rowPerPage=parseInt(data[valueObject].rowPerPage),DataTable.cacheData[tableid].totalCount=parseInt(data[valueObject].totalCount),DataTable.cacheData[tableid].order=dataTableOrder,DataTable.cacheData[tableid].sort=dataTableSort,DataTable.cacheData[tableid].maxPage=Math.floor((DataTable.cacheData[tableid].totalCount-1)/DataTable.cacheData[tableid].rowPerPage+1);for(i in data[valueObject].data){data[valueObject].data[i].datatableCount=parseInt(j)+1,data[valueObject].data[i].datatableIndex=parseInt(j);for(property in data)property!=valueObject&&(data[valueObject].data[i][property]=data[property]);data[valueObject].data[i].pageNo=parseInt(data[valueObject].pageNo),data[valueObject].data[i].rowPerPage=parseInt(data[valueObject].rowPerPage),data[valueObject].data[i].totalCount=parseInt(data[valueObject].totalCount),data[valueObject].data[i].maxPage=Math.floor((parseInt(data[valueObject].data[i].totalCount)-1)/parseInt(data[valueObject].data[i].rowPerPage)+1),data[valueObject].data[i].key=i,data[valueObject].data[i].order=dataTableOrder,data[valueObject].data[i].sort=dataTableSort,content+=DataTable.formatContent(DataTable.cacheDataRow[tableid],data[valueObject].data[i]),j++}}else{dataTableOrder=data.order,dataTableSort=data.sort,dataTableOrder||(dataTableOrder=""),dataTableSort||(dataTableSort=""),DataTable.cacheData[tableid].maxPage=Math.floor((parseInt(data.totalCount)-1)/parseInt(data.rowPerPage)+1);for(i in data.data){for(property in data)"data"!=property&&(data.data[i][property]=data[property]);data.data[i].datatableCount=parseInt(j)+1,data.data[i].datatableIndex=parseInt(j),data.data[i].key=i,data.data[i].maxPage=Math.floor((parseInt(data.data[i].totalCount)-1)/parseInt(data.data[i].rowPerPage)+1),data.data[i].order=dataTableOrder,data.data[i].sort=dataTableSort,content+=DataTable.formatContent(DataTable.cacheDataRow[tableid],data.data[i]),j++}}if(DataTable.pageTheme(tableid,DataTable.cachePageTheme[tableid]),dataForm.find(" .pages .totalCount").html(data.totalCount),dataForm.find(" .mycombox").val(data.rowPerPage),dataForm.find(" [name='pageNo']").val(data.pageNo),dataForm.find(" .pages .maxPage").html(Math.floor((parseInt(data.totalCount)-1)/parseInt(data.rowPerPage)+1)),dataForm.find("[name='rowPerPage']").off("change"),dataForm.find("[name='rowPerPage']").on("change",function(){var b=$(this).val(),c=dataForm.find("[name='pageNo']"),d=Math.floor((DataTable.cacheData[tableid].totalCount-1)/b+1);c.val()>d&&c.val(d),DataTable.load(tableid)}),DataTable.pageCheck(tableid),orderInfo='<tr name="sort_order_hidden" style="display:none"><td colspan=\''+$("[id='"+tableid+"'] tr:eq(0)").find("th").length+"'><input type='hidden' name='order' value='"+dataTableOrder+"'/>"+"<input type='hidden' name='sort' value='"+dataTableSort+"'/></td></tr>",content+=orderInfo,nowDataTable.find(" tr:gt(0)").remove(),$("[id='"+tableid+"_loading_div']").remove(),nowDataTable.append(content),nowDataTable.find(" tr:even").addClass("evenColor"),nowDataTable.find(" tr").hover(function(){$(this).addClass("tdHover")},function(){$(this).removeClass("tdHover")}),nowDataTable.find(" tr").on("click",function(){oldTr&&oldTr.removeClass("tdClick"),$(this).addClass("tdClick"),oldTr=$(this)}),DataTable.cacheEndFun[tableid])try{DataTable.cacheEndFun[tableid](nowDataTable[0],!DataTable.cacheInit[tableid])}catch(e){}DataTable.cacheInit[tableid]||(DataTable.cacheInit[tableid]=!0,$("#datatable_initPageData").remove())})}},reload:function(a){var b=$("form").has("[id='"+a+"']");b.find("[name='order']").val(""),b.find("[name='sort']").val(""),DataTable.cacheOrderArrow[a]&&DataTable.cacheOrderArrow[a].html("&uarr;&darr;"),DataTable.load(a)},out:function(a){return a},formatContent:function(content,jsondata){var reg=/\{([^}]+)\}/g,regExp=/\%\{(.*)\}\%/g;return content=content.replace(regExp,function(m,i){with(jsondata)try{return eval($.trim(i))}catch(e){return m}}),content=content.replace(reg,function(m,i){with(jsondata)try{return null==eval($.trim(i))?"":eval($.trim(i))}catch(e){return""}})},Validate:{integer:/^[1-9][0-9]*$/},first:function(a){var b=$("form").has("[id='"+a+"']"),c=b.find("[name='pageNo']");c.val(1),this.load(a)},prev:function(a){var b=$("form").has("[id='"+a+"']"),c=b.find("[name='pageNo']");c.val(parseInt(this.cacheData[a].pageNo)-1),this.load(a)},next:function(a){var b=$("form").has("[id='"+a+"']"),c=b.find("[name='pageNo']");c.val(parseInt(this.cacheData[a].pageNo)+1),this.load(a)},last:function(a){var b=$("form").has("[id='"+a+"']"),c=b.find("[name='pageNo']");c.val(this.cacheData[a].maxPage),this.load(a)},gopage:function(a){var b=$("form").has("[id='"+a+"']"),c=b.find("[name='pageNo']"),d=b.find("[name='rowPerPage']").val(),e=Math.floor((this.cacheData[a].totalCount-1)/d+1);c.val()>e&&c.val(e),this.cacheData[a].pageNo!=c.val()&&DataTable.Validate.integer.test(c.val())&&this.load(a)},numgoto:function(a,b){var c=$("form").has("[id='"+a+"']"),d=c.find("[name='pageNo']");d.val($(b.target).text()),this.cacheData[a].pageNo!=c.find("[name='pageNo']").val()&&this.load(a)},go:function(a,b,c){var e,f,g,d=$("form").has("[id='"+a+"']");d&&DataTable.Validate.integer.test(b)&&(b=parseInt(b),0>=b&&(b=1),c&&DataTable.Validate.integer.test(c)||(c=this.cacheData[a].rowPerPage),e=Math.floor((this.cacheData[a].totalCount-1)/c+1),b>e&&(b=e),f=d.find("[name='pageNo']"),f.val()?f.val(b):d.append('<input type="hidden" value="'+b+'" name="pageNo"/>'),g=d.find("[name='rowPerPage']"),g.val()?g.val(c):d.append('<input type="hidden" value="'+c+'" name="rowPerPage"/>'),d.find("[name='rowPerPage']").val(c),this.cacheData[a].pageNo!=b&&this.load(a))},pageCheck:function(a){var b=$("form").has("[id='"+a+"']"),c=this.cacheData[a].maxPage,d=parseInt(this.cacheData[a].pageNo),e=b.find("[name='first']"),f=b.find("[name='prev']"),g=b.find("[name='next']"),h=b.find("[name='last']"),i=b.find("[name='pagegoto']"),j=b.find("[name='numgoto']");e.off("click"),f.off("click"),g.off("click"),h.off("click"),i.off("click"),j.off("click"),e.on("click",function(){DataTable.first(a)}),f.on("click",function(){DataTable.prev(a)}),g.on("click",function(){DataTable.next(a)}),h.on("click",function(){DataTable.last(a)}),i.on("click",function(){DataTable.gopage(a)}),j.on("click",function(b){DataTable.numgoto(a,b)}),e.unbind("mouseenter").unbind("mouseleave"),f.unbind("mouseenter").unbind("mouseleave"),g.unbind("mouseenter").unbind("mouseleave"),h.unbind("mouseenter").unbind("mouseleave"),DataTable.loadInit(),e.removeClass("firstlastgo"),f.removeClass("firstlastgo"),g.removeClass("firstlastgo"),h.removeClass("firstlastgo"),1>=d&&(e.off("click"),f.off("click"),e.removeClass("pageGoHover"),f.removeClass("pageGoHover"),e.addClass("firstlastgo"),f.addClass("firstlastgo"),e.unbind("mouseenter").unbind("mouseleave"),f.unbind("mouseenter").unbind("mouseleave")),d>=c&&(h.off("click"),g.off("click"),h.removeClass("pageGoHover"),g.removeClass("pageGoHover"),h.addClass("firstlastgo"),g.addClass("firstlastgo"),h.unbind("mouseenter").unbind("mouseleave"),g.unbind("mouseenter").unbind("mouseleave"))},checkAll:function(a,b){var c=a.checked;c?$(a.form).find("[name='"+b+"']").each(function(){this.checked=!0}):$(a.form).find("[name='"+b+"']").each(function(){this.checked=!1})},pageMsgCkeck:function(a){DataTable.cacheLanguage[a].first||(DataTable.cacheLanguage[a].first=DataTable.MSG.first),DataTable.cacheLanguage[a].previous||(DataTable.cacheLanguage[a].previous=DataTable.MSG.previous),DataTable.cacheLanguage[a].next||(DataTable.cacheLanguage[a].next=DataTable.MSG.next),DataTable.cacheLanguage[a].last||(DataTable.cacheLanguage[a].last=DataTable.MSG.last),DataTable.cacheLanguage[a].totalPage||(DataTable.cacheLanguage[a].totalPage=DataTable.MSG.totalPage),DataTable.cacheLanguage[a].rowPerPage||(DataTable.cacheLanguage[a].rowPerPage=DataTable.MSG.rowPerPage),DataTable.cacheLanguage[a].totalCount||(DataTable.cacheLanguage[a].totalCount=DataTable.MSG.totalCount)},pageNumSpan:function(a,b){var c,d,e,f,g;for(b=parseInt(b),c=Math.floor((parseInt(this.cacheData[a].totalCount)-1)/parseInt(this.cacheData[a].rowPerPage)+1),d=b-3,e=b+3,1>d&&(d=1,e=d+6,e>c&&(e=c)),e>c&&(e=c,d=e-6,1>d&&(d=1)),f="",g=d;e>=g;g++)f+=g==b?'<span class="pagego nowpagenum" name="numgoto"  value="numgoto_'+g+'">'+g+"</span>":'<span class="pagego" name="numgoto" value="numgoto_'+g+'">'+g+"</span>";return f},pageTheme:function(a,b){var e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,c=$("form").has("[id='"+a+"']"),d="";b&&"no"==b.toLowerCase()?d=DataTable.cacheUserPage[a]:(e=c.find(".panelBar").length,0!=e&&(f=c.find(".panelBar").attr("size"),g=[DataTable.cacheData[a].rowPerPage],f&&(g=f.split(",")),this.cacheDefaultRow[a]&&(h="#"+g.join("#")+"#",-1!=h.indexOf("#"+this.cacheDefaultRow[a]+"#")?this.cacheDefaultRow[a]=null:g.push(this.cacheDefaultRow[a])),g.sort(function(a,b){return parseInt(a)-parseInt(b)}),DataTable.pageMsgCkeck(a),i=DataTable.cacheLanguage[a].rowPerPage.indexOf("{0}"),j=DataTable.cacheLanguage[a].rowPerPage.substring(0,i),k=DataTable.cacheLanguage[a].rowPerPage.substring(i+3),l='<div class="pages"><span>'+j+"</span>"+'<select class="mycombox" name="rowPerPage" >',$.each(g,function(a,b){l+='<option value="'+b+'" >'+b+"</option>"}),l+="</select><span>"+k+"，",m=DataTable.cacheLanguage[a].totalPage.indexOf("{0}"),n=DataTable.cacheLanguage[a].totalPage.substring(0,m),o=DataTable.cacheLanguage[a].totalPage.substring(m+3),p=DataTable.cacheLanguage[a].totalCount.indexOf("{0}"),q=DataTable.cacheLanguage[a].totalCount.substring(0,p),r=DataTable.cacheLanguage[a].totalCount.substring(p+3),l+=q+'<label class="totalCount"></label>'+r+"</span></div>",s='<div class="pages " style="float: right;text-align: right;">',t='<span class="totalPage">'+n+'<label class="maxPage"></label>'+o+"</span>",u='<span class="pagego" name="first">'+DataTable.cacheLanguage[a].first+"</span>"+'<span class="pagego" name="prev">'+DataTable.cacheLanguage[a].previous+"</span>",v="<span id='datatable_pagenum'>"+this.pageNumSpan(a,this.cacheData[a].pageNo)+"</span>",w='<span class="pagego" name="next">'+DataTable.cacheLanguage[a].next+"</span>"+'<span class="pagego" name="last">'+DataTable.cacheLanguage[a].last+"</span>",x='<span class="pagego"><input type="text" class="gototxt" name="pageNo"  /></span>',x+='<span class="pagegoto" name="pagegoto">&gt;&gt;</span>',y="</div>",d=b&&"FULL"!=b.toUpperCase()?"SIMPLE"==b.toUpperCase()?l+s+t+u+w+x+y:l+s+t+u+v+w+x+y:l+s+t+u+v+w+x+y)),c.find(".panelBar").html(DataTable.formatContent(d,this.cacheData[a]))},loadInit:function(){$(".pagego").hover(function(){$(this).addClass("pageGoHover")},function(){$(this).removeClass("pageGoHover")})},init:function(){$(".pagego").hover(function(){$(this).addClass("pageGoHover")},function(){$(this).removeClass("pageGoHover")}),$(".datatable").find("tr:eq(1)").css("visibility","hidden"),$("[class~='easydatatable']").each(function(){var a=$(this).attr("id");DataTable.cacheInit[a]||a&&DataTable.load(a)}),$("[class~='easydatatable_search']").each(function(){var a=$(this.form).find("table[id]").attr("id"),b=$(this);b.off("click"),b.on("click",function(){a&&DataTable.load(a)})}),$("table:has([order])").each(function(){var a=$(this),b=a.attr("id");a.find("[order]").each(function(){var c,a=$(this);a.html(a.html()+"<span class='sortArrow' name='orderspan'>&uarr;&darr;</span>"),a.css("cursor","pointer"),a.off("click"),c=$("form").has("[id='"+b+"']"),a.on("click",function(){var f,e=a.attr("order");c.find("input[name='order']").length>0&&(c.find("input[name='order']").val(e),c.find("input[name='sort']").val("asc"==c.find("input[name='sort']").val().toLowerCase()?"desc":"asc"),f=$(this).find("[name='orderspan']"),DataTable.cacheOrderArrow[b]&&DataTable.cacheOrderArrow[b].html("&uarr;&darr;"),"asc"==c.find("input[name='sort']").val()?f.html("&uarr;"):"desc"==c.find("input[name='sort']").val()?f.html("&darr;"):f.html("&uarr;&darr;"),DataTable.cacheOrderArrow[b]=f,DataTable.load(b))})}),a.find("[order]").hover(function(){var a=$(this).find("[name='orderspan']");a.removeClass("sortArrow"),a.removeClass("sortArrowDown"),a.addClass("sortArrowHover")},function(){var a=$(this).find("[name='orderspan']");a.removeClass("sortArrowHover"),a.addClass("sortArrow")}),a.find("[order]").on("mousedown",function(){var a=$(this).find("[name='orderspan']");a.removeClass("sortArrowHover"),a.addClass("sortArrowDown")}),a.find("[order]").on("mouseup",function(){var a=$(this).find("[name='orderspan']");a.removeClass("sortArrowDown"),a.addClass("sortArrowHover")})})}};$(function(){DataTable.init()});